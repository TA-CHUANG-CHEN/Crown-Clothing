{"ast":null,"code":"import _regeneratorRuntime from\"/Users/dazhuangchen/Desktop/Coding/Crown-Clothing/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/Users/dazhuangchen/Desktop/Coding/Crown-Clothing/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/Users/dazhuangchen/Desktop/Coding/Crown-Clothing/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/dazhuangchen/Desktop/Coding/Crown-Clothing/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/dazhuangchen/Desktop/Coding/Crown-Clothing/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/dazhuangchen/Desktop/Coding/Crown-Clothing/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/dazhuangchen/Desktop/Coding/Crown-Clothing/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from\"react\";import{Route,Switch,Redirect}from\"react-router-dom\";import{connect}from\"react-redux\";import{createStructuredSelector}from\"reselect\";import CheckoutPage from\"./pages/checkout/checkout.component\";import\"./App.css\";import HomePage from\"./pages/homepage/homepage.component\";import ShopPage from\"./pages/shop/shop.component\";import Header from\"./components/header/header.component\";import SignInSignUpPage from\"./pages/sing-in-sign-up/sign-in-sign-up.component\";import{auth,creatUserProfileDocument}from\"./firebase/firebase.utils\";import{setCurrentUser as _setCurrentUser}from\"./redux/user/user.actions\";import{selectCurrentUser}from\"./redux/user/user.selectors\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var App=/*#__PURE__*/function(_React$Component){_inherits(App,_React$Component);var _super=_createSuper(App);function App(){var _this;_classCallCheck(this,App);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.unsubscribeFromAuth=null;return _this;}_createClass(App,[{key:\"componentDidMount\",value:function componentDidMount(){// const setCurrentUser = this.props.setCurrentUser; same\nvar setCurrentUser=this.props.setCurrentUser;//this props dispatch from mapDispatchtoProps setCurrentUser\n// we need react to listening user state.\nthis.unsubscribeFromAuth=auth.onAuthStateChanged(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(userAuth){var userRef;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!userAuth){_context.next=5;break;}_context.next=3;return creatUserProfileDocument(userAuth);case 3:userRef=_context.sent;// if don't exist create do or return user directly.\nuserRef.onSnapshot(function(snapShot){// const snapshot = await userRef.get(); / retrive uid from users/userAuth.uid\nsetCurrentUser(_objectSpread({id:snapShot.id},snapShot.data()));});case 5:setCurrentUser(userAuth);// CurrentUser is null.\ncase 6:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}());}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.unsubscribeFromAuth();}},{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Header,{}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(Route,{exact:true,path:\"/\",component:HomePage}),/*#__PURE__*/_jsx(Route,{path:\"/shop\",component:ShopPage}),/*#__PURE__*/_jsx(Route,{exact:true,path:\"/checkout\",component:CheckoutPage}),/*#__PURE__*/_jsx(Route,{exact:true,path:\"/signin\",render:function render(){return _this2.props.currentUser?/*#__PURE__*/_jsx(Redirect,{to:\"/\"}):/*#__PURE__*/_jsx(SignInSignUpPage,{});}})]})]});}}]);return App;}(React.Component);var mapStateToProps=createStructuredSelector({currentUser:selectCurrentUser// replace (rootreducer == state) => currentUser: state.user.currentUser\n});/*\nAbout mapStatetoProps\n\n1.It is called every time the store state changes.\n2.It receives the entire store state, and should return an object of data this component needs, so that why we need reselector.\n\n*/var mapDispatchToProps=function mapDispatchToProps(dispatch){return{setCurrentUser:function setCurrentUser(user){return dispatch(_setCurrentUser(user));}};};/*\nAbout mapDispatchToProps\nReact Redux gives you two ways to let components dispatch actions:\n(dispatch is a function of the Redux store. You call store.dispatch to dispatch an action. This is the only way to trigger a state change)\n1. By default, a connected component receives props.dispatch and can dispatch actions itself.\n2. connect can accept an argument called mapDispatchToProps, which lets you create functions that dispatch when called, \n   and pass those functions as props to your component.\n   ( if you define your own mapDispatchToProps, the connected component will no longer receive dispatch.)\n*/ /* In conclusion,  mapStateToProps can receive props into state everywhere ,mapDispatchToProps is the only way pass state props */export default connect(mapStateToProps,mapDispatchToProps)(App);","map":{"version":3,"sources":["/Users/dazhuangchen/Desktop/Coding/Crown-Clothing/src/App.js"],"names":["React","Route","Switch","Redirect","connect","createStructuredSelector","CheckoutPage","HomePage","ShopPage","Header","SignInSignUpPage","auth","creatUserProfileDocument","setCurrentUser","selectCurrentUser","App","unsubscribeFromAuth","props","onAuthStateChanged","userAuth","userRef","onSnapshot","snapShot","id","data","currentUser","Component","mapStateToProps","mapDispatchToProps","dispatch","user"],"mappings":"ooCAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,OAASC,KAAT,CAAgBC,MAAhB,CAAwBC,QAAxB,KAAwC,kBAAxC,CACA,OAASC,OAAT,KAAwB,aAAxB,CACA,OAASC,wBAAT,KAAyC,UAAzC,CACA,MAAOC,CAAAA,YAAP,KAAyB,qCAAzB,CACA,MAAO,WAAP,CACA,MAAOC,CAAAA,QAAP,KAAqB,qCAArB,CACA,MAAOC,CAAAA,QAAP,KAAqB,6BAArB,CACA,MAAOC,CAAAA,MAAP,KAAmB,sCAAnB,CACA,MAAOC,CAAAA,gBAAP,KAA6B,mDAA7B,CACA,OAASC,IAAT,CAAeC,wBAAf,KAA+C,2BAA/C,CACA,OAASC,cAAc,GAAdA,CAAAA,eAAT,KAA+B,2BAA/B,CACA,OAASC,iBAAT,KAAkC,6BAAlC,C,2FAEMC,CAAAA,G,2TACJC,mB,CAAsB,I,gEAEtB,4BAAoB,CAClB;AADkB,GAEVH,CAAAA,cAFU,CAES,KAAKI,KAFd,CAEVJ,cAFU,CAEqB;AACvC;AACA,KAAKG,mBAAL,CAA2BL,IAAI,CAACO,kBAAL,0FAAwB,iBAAOC,QAAP,kIAG7CA,QAH6C,+CAIzBP,CAAAA,wBAAwB,CAACO,QAAD,CAJC,QAIzCC,OAJyC,eAIW;AAC1DA,OAAO,CAACC,UAAR,CAAmB,SAACC,QAAD,CAAc,CAC/B;AACAT,cAAc,gBACZU,EAAE,CAAED,QAAQ,CAACC,EADD,EAETD,QAAQ,CAACE,IAAT,EAFS,EAAd,CAID,CAND,EAL+C,OAajDX,cAAc,CAACM,QAAD,CAAd,CAA0B;AAbuB,sDAAxB,+DAA3B,CAeD,C,oCACD,+BAAuB,CACrB,KAAKH,mBAAL,GACD,C,sBACD,iBAAS,iBACP,mBACE,oCACE,KAAC,MAAD,IADF,cAEE,MAAC,MAAD,yBAEE,KAAC,KAAD,EAAO,KAAK,KAAZ,CAAa,IAAI,CAAC,GAAlB,CAAsB,SAAS,CAAET,QAAjC,EAFF,cAQE,KAAC,KAAD,EAAO,IAAI,CAAC,OAAZ,CAAoB,SAAS,CAAEC,QAA/B,EARF,cASE,KAAC,KAAD,EAAO,KAAK,KAAZ,CAAa,IAAI,CAAC,WAAlB,CAA8B,SAAS,CAAEF,YAAzC,EATF,cAUE,KAAC,KAAD,EACE,KAAK,KADP,CAEE,IAAI,CAAC,SAFP,CAGE,MAAM,CAAE,wBACN,CAAA,MAAI,CAACW,KAAL,CAAWQ,WAAX,cACE,KAAC,QAAD,EAAU,EAAE,CAAC,GAAb,EADF,cAGE,KAAC,gBAAD,IAJI,EAHV,EAVF,GAFF,GADF,CA2BD,C,iBAtDezB,KAAK,CAAC0B,S,EAwDxB,GAAMC,CAAAA,eAAe,CAAGtB,wBAAwB,CAAC,CAC/CoB,WAAW,CAAEX,iBAAmB;AADe,CAAD,CAAhD,CAGA;AACA;AACA;AACA;AACA;AACA;AACA,EACA,GAAMc,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,CAACC,QAAD,QAAe,CACxChB,cAAc,CAAE,wBAACiB,IAAD,QAAUD,CAAAA,QAAQ,CAAChB,eAAc,CAACiB,IAAD,CAAf,CAAlB,EADwB,CAAf,EAA3B,CAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,E,CACA,kIACA,cAAe1B,CAAAA,OAAO,CAACuB,eAAD,CAAkBC,kBAAlB,CAAP,CAA6Cb,GAA7C,CAAf","sourcesContent":["import React from \"react\";\nimport { Route, Switch, Redirect } from \"react-router-dom\";\nimport { connect } from \"react-redux\";\nimport { createStructuredSelector } from \"reselect\";\nimport CheckoutPage from \"./pages/checkout/checkout.component\";\nimport \"./App.css\";\nimport HomePage from \"./pages/homepage/homepage.component\";\nimport ShopPage from \"./pages/shop/shop.component\";\nimport Header from \"./components/header/header.component\";\nimport SignInSignUpPage from \"./pages/sing-in-sign-up/sign-in-sign-up.component\";\nimport { auth, creatUserProfileDocument } from \"./firebase/firebase.utils\";\nimport { setCurrentUser } from \"./redux/user/user.actions\";\nimport { selectCurrentUser } from \"./redux/user/user.selectors\";\n\nclass App extends React.Component {\n  unsubscribeFromAuth = null;\n\n  componentDidMount() {\n    // const setCurrentUser = this.props.setCurrentUser; same\n    const { setCurrentUser } = this.props; //this props dispatch from mapDispatchtoProps setCurrentUser\n    // we need react to listening user state.\n    this.unsubscribeFromAuth = auth.onAuthStateChanged(async (userAuth) => {\n      //auth() The Firebase Auth service interface listening auth state like sign-in props is user.\n      //creatUserProfileDocument(user);user(props) => creatUserProfileDocument\n      if (userAuth) {\n        const userRef = await creatUserProfileDocument(userAuth); // if don't exist create do or return user directly.\n        userRef.onSnapshot((snapShot) => {\n          // const snapshot = await userRef.get(); / retrive uid from users/userAuth.uid\n          setCurrentUser({\n            id: snapShot.id, //  userRef.get().id...\n            ...snapShot.data(), //use data() retrived property from  userRef.get().data().\n          });\n        });\n      }\n      setCurrentUser(userAuth); // CurrentUser is null.\n    });\n  }\n  componentWillUnmount() {\n    this.unsubscribeFromAuth();\n  }\n  render() {\n    return (\n      <div>\n        <Header />\n        <Switch>\n          {/* 1. Switch will render the first child <Route> or <Redirect> that matches the location */}\n          <Route exact path=\"/\" component={HomePage} />\n          {/* \n        1. All route props (match, location and history) are available to Homepages \n        2. Routes without a path always match, path='/' means when homepage will be render URL with /. like http://www.test.com/ <- start from here.\n        3. When exact == true, will only match if the path matches the location.pathname exactly.\n        */}\n          <Route path=\"/shop\" component={ShopPage} />\n          <Route exact path=\"/checkout\" component={CheckoutPage} />\n          <Route\n            exact\n            path=\"/signin\"\n            render={() =>\n              this.props.currentUser ? (\n                <Redirect to=\"/\" />\n              ) : (\n                <SignInSignUpPage />\n              )\n            }\n          />\n        </Switch>\n      </div>\n    );\n  }\n}\nconst mapStateToProps = createStructuredSelector({\n  currentUser: selectCurrentUser, // replace (rootreducer == state) => currentUser: state.user.currentUser\n});\n/*\nAbout mapStatetoProps\n\n1.It is called every time the store state changes.\n2.It receives the entire store state, and should return an object of data this component needs, so that why we need reselector.\n\n*/\nconst mapDispatchToProps = (dispatch) => ({\n  setCurrentUser: (user) => dispatch(setCurrentUser(user)),\n});\n/*\nAbout mapDispatchToProps\nReact Redux gives you two ways to let components dispatch actions:\n(dispatch is a function of the Redux store. You call store.dispatch to dispatch an action. This is the only way to trigger a state change)\n1. By default, a connected component receives props.dispatch and can dispatch actions itself.\n2. connect can accept an argument called mapDispatchToProps, which lets you create functions that dispatch when called, \n   and pass those functions as props to your component.\n   ( if you define your own mapDispatchToProps, the connected component will no longer receive dispatch.)\n*/\n/* In conclusion,  mapStateToProps can receive props into state everywhere ,mapDispatchToProps is the only way pass state props */\nexport default connect(mapStateToProps, mapDispatchToProps)(App);\n\n\n"]},"metadata":{},"sourceType":"module"}